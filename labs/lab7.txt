PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX org:  <http://www.w3.org/ns/org#>
PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX : <http://datosabiertos.cl/v/>

#P4

SELECT ?unidad ?nombre ?estamento ?sueldo
WHERE{
    ?membership a org:Membership; org:member ?person .
    ?person foaf:name ?nombre . 
    ?membership :remuneracionBrutaMensual ?sueldo .
    ?membership :estamento ?estamento .
    ?membership org:organization ?org.
    ?org a org:OrganizationalUnit; foaf:name ?unidad .

    FILTER( ?max_sueldo = ?sueldo)
    {
      SELECT ?unidad (max(?sueldo) AS ?max_sueldo )
      WHERE{
            ?membership a org:Membership; :remuneracionBrutaMensual ?sueldo .
            ?membership org:organization ?org.
            ?org a org:OrganizationalUnit; foaf:name ?unidad .

      }
      GROUP BY ?unidad 
    }
}
ORDER BY (?unidad)




#P6


SELECT ?nombre ?sueldo 

WHERE {
    ?membership a org:Membership; org:member ?person .
    ?person foaf:name ?nombre . 
    ?membership :remuneracionBrutaMensual ?sueldo .
    FILTER( ?mayores_sueldos <= ?one_percent)

    {
      SELECT (count (distinct ?person)/100 as ?one_percent )
      WHERE{ ?membership a org:Membership; org:member ?person . }
    }

    {    
      SELECT ?person (count(?person) as ?mayores_sueldos)
      WHERE{
        ?membership a org:Membership; org:member ?person .
        ?person foaf:name ?nombre . 
        ?membership :remuneracionBrutaMensual ?sueldo .
        
        ?membership2 a org:Membership.
        ?membership2 :remuneracionBrutaMensual ?sueldo2 .

        FILTER(?sueldo2> ?sueldo && ?membership2 != ?membership)    
      }
      GROUP BY (?person)
    }
}

ORDER BY DESC(?sueldo)